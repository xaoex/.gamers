#!/usr/bin/env bash
# .gamers Bash Prompt - AI Agent Themed Prompt

# Set terminal colors
if [[ $COLORTERM = gnome-* && $TERM = xterm ]] && infocmp gnome-256color >/dev/null 2>&1; then
	export TERM='gnome-256color'
elif infocmp xterm-256color >/dev/null 2>&1; then
	export TERM='xterm-256color'
fi

# Git status in prompt
prompt_git() {
	local s=''
	local branchName=''

	git rev-parse --is-inside-work-tree &>/dev/null || return

	branchName="$(git symbolic-ref --quiet --short HEAD 2>/dev/null || \
		git describe --all --exact-match HEAD 2>/dev/null || \
		git rev-parse --short HEAD 2>/dev/null || \
		echo '(unknown)')"

	# Check for changes
	if ! $(git diff --quiet --ignore-submodules --cached); then
		s+='+'
	fi
	if ! $(git diff-files --quiet --ignore-submodules --); then
		s+='!'
	fi
	if [ -n "$(git ls-files --others --exclude-standard)" ]; then
		s+='?'
	fi
	if $(git rev-parse --verify refs/stash &>/dev/null); then
		s+='$'
	fi

	[ -n "${s}" ] && s=" [${s}]"

	echo -e "${1}${branchName}${2}${s}"
}

# Colors
if tput setaf 1 &>/dev/null; then
	tput sgr0
	bold=$(tput bold)
	reset=$(tput sgr0)
	cyan=$(tput setaf 37)
	green=$(tput setaf 64)
	magenta=$(tput setaf 125)
	purple=$(tput setaf 61)
	white=$(tput setaf 15)
	yellow=$(tput setaf 136)
else
	bold=''
	reset="\e[0m"
	cyan="\e[1;36m"
	green="\e[1;32m"
	magenta="\e[1;35m"
	purple="\e[1;35m"
	white="\e[1;37m"
	yellow="\e[1;33m"
fi

# User style (highlight root)
if [[ "${USER}" == "root" ]]; then
	userStyle="${magenta}"
else
	userStyle="${cyan}"
fi

# Show current world in prompt if set
prompt_world() {
	if [ -n "$GAMERS_CURRENT_WORLD" ]; then
		echo -e " üåç ${purple}${GAMERS_CURRENT_WORLD}"
	fi
}

# Build the prompt
PS1="\[\033]0;üéÆ .gamers - \W\007\]"  # Window title
PS1+="\[${bold}\]\n"
PS1+="üéÆ "                              # .gamers icon
PS1+="\[${userStyle}\]\u"               # Username
PS1+="\[${white}\]@"
PS1+="\[${yellow}\]\h"                  # Hostname
PS1+="\[${white}\] in "
PS1+="\[${green}\]\w"                   # Working directory
PS1+="\$(prompt_git \"\[${white}\] on \[${purple}\]\" \"\[${cyan}\]\")"  # Git info
PS1+="\$(prompt_world)"                 # Current world
PS1+="\n"
PS1+="\[${white}\]‚Üí \[${reset}\]"       # Prompt symbol
export PS1

PS2="\[${yellow}\]  ‚Üí \[${reset}\]"
export PS2
